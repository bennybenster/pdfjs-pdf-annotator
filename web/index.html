<!-- index.html -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>PDF Annotator (Static)</title>
  <style>html,body{margin:0;height:100%}#viewerHost{width:100%;height:100%}</style>
</head>
<body>
  <div id="viewerHost"></div>
  <script type="module">
  // 1) spawn the viewer iframe
  const host = document.getElementById("viewerHost");
  function spawn() {
    host.innerHTML = "";
    const f = document.createElement("iframe");
    f.src = "viewer.html";
    f.style.width = "100%";
    f.style.height = "100%";
    host.appendChild(f);
  }
  spawn();

  // 2) catch the save-request and do an <a download>
  window.addEventListener("message", e => {
    if (e.data?.type === "requestSavePdf") {
      const { defaultName, data: arr } = e.data;
      const u8 = new Uint8Array(arr);
      const blob = new Blob([u8], {type:"application/pdf"});
      const url  = URL.createObjectURL(blob);
      const a    = document.createElement("a");
      a.href     = url;
      a.download = defaultName;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
      // tell the iframe we “saved” and pass the same bytes back
      e.source.postMessage({type:"responseSavePdf", newName: defaultName, data: arr}, "*");
    }
  });
  </script>
</body>
</html>
